@{
    ViewData["Title"] = "List Buddy";
}

@model UsefulWebApps.Models.ViewModels.ListBuddy.ToDoListVM

<div class="text-center to-do-list-container mx-auto">
    <h1 class="display-4">To Do List</h1>
    <ul class="list-group">
        @foreach (var obj in Model.ToDoListItems)
        {
            <li class="list-group-item">
                <span class="fw-bold to-do-list-item @(obj.Complete == true ? "line-through" : "")">@obj.ToDoItem</span>
                <div>
                    <form method="post" asp-route="toggleToDoComplete" class="to-do-list-mark-complete">
                        <input asp-for="@obj.Id" name="id" hidden />
                        <button type="submit" class="btn btn-success">Complete</button>
                    </form>
                    <div class="to-do-list-edit">
                        <a asp-controller="ListBuddy" asp-action="ToDoListEdit" asp-route-id="@obj.Id" class="btn btn-primary">Edit</a>
                    </div>
                    <form method="post" asp-route="deleteToDoItem" class="to-do-list-delete-item" id="delete-to-do-item">
                        <input asp-for="@obj.Id" name="id" hidden />
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </li>
        }
    </ul>
    <form method="post" asp-route="createToDoItem" class="add-to-do-item">
        <div class="input-group mb-3 mt-3">
            <!--Complete default value is False-->
            <input asp-for="ToDoList.Complete" hidden />
            <input asp-for="ToDoList.ToDoItem" type="text" class="form-control" placeholder="new item" minlength="3" maxlength="100" />
            <input asp-for="ToDoList.UserId" hidden />
            <button class="btn btn-primary" type="submit">Add Item</button> 
        </div>
        <div class="mb-2">
            <span asp-validation-for="ToDoList.ToDoItem" class="text-danger"></span>
        </div>
    </form>

    <form method="post" asp-route="deleteAllToDoList" class="delete-all-to-do-item mx-auto" id="delete-all-to-do">
        <div>
            <button type="submit" class="btn btn-danger mb-2 w-100">Delete All</button>
        </div>
        <div>
            <a asp-controller="ListBuddy" asp-action="Index" class="btn btn-primary w-100">List Buddy Home</a>
        </div>
    </form>
    
</div>
<!--Partial View scripts-->
@section Scripts {
    @{
        <partial name="_ValidationScriptsPartial" />
    }
    <script type="text/javascript">
        $("#delete-all-to-do").validate({
            submitHandler: function (form) {
                //ask to confirm delete
                toastConfirm().then(deleteConfirm => {
                    if (deleteConfirm == true) {
                        form.submit();
                    }
                    else {
                        toastr.success("Item has NOT been deleted");
                    }
                });
            }
        });
        //wont work for list as there will be lots of items with same id=delete-to-do-item
        $("#delete-to-do-item").validate({
            submitHandler: function (form) {
                //ask to confirm delete
                toastConfirm().then(deleteConfirm => {
                    if (deleteConfirm == true) {
                        form.submit();
                    }
                    else {
                        toastr.success("Item has NOT been deleted");
                    }
                });
            }
        });
    </script>
}
